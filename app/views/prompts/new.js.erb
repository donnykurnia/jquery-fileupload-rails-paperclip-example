// render the partial form
var upload_prompt = "<%=j render(@prompt) %>";

// append into placeholder area
$("#prompt_area").append(upload_prompt);

// find the newly added form id then get the form object
var form_id = $(upload_prompt).find('.fileupload').attr('id');
var form = $("#"+form_id);

// Initialize the jQuery File Upload widget:
form.fileupload({
  dropZone: form
}).bind('fileuploadsubmit', function (e, data) {
  var inputs = data.context.find('input:text');
  if (inputs.filter('[required]').filter(function() { return $(this).val() == ""; }).first().focus().length) {
    return false;
  }
  data.formData = inputs.serializeArray();
});
